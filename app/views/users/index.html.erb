<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</h1>
        <div>
          <%= link_to "ÁÆ°ÁêÜÁîªÈù¢„Å´Êàª„Çã", admin_path, class: "btn btn-outline-primary" %>
          <%= link_to "Êñ∞„Åó„ÅÑ„É¶„Éº„Ç∂„Éº„ÇíÁôªÈå≤", new_user_path, class: "btn btn-success ms-2" %>
        </div>
      </div>

      <!-- „É¶„Éº„Ç∂„Éº‰∏ÄË¶ß„ÉÜ„Éº„Éñ„É´ -->
      <div class="card">
        <div class="card-body">
          <h3 class="card-title">„É¶„Éº„Ç∂„Éº‰∏ÄË¶ß</h3>
          
          <% if @users.any? %>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th><%= sortable_link('id', 'ID', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('name', 'ÂêçÂâç', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('email', '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('level', '„É¨„Éô„É´', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('total_development_time', 'Á∑èÈñãÁô∫ÊôÇÈñì', @current_sort, @current_order) %></th>
                    <th>„É°„É≥„Çø„Éº</th>
                    <th>Ê¨°„ÅÆ„É¨„Éô„É´„Ç¢„ÉÉ„Éó</th>
                    <th><%= sortable_link('nullpo_count', '„Å¨„Çã„ÅΩÊï∞', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('total_clicks', 'Á∑è„ÇØ„É™„ÉÉ„ÇØÊï∞', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('click_power', '„ÇØ„É™„ÉÉ„ÇØÂäõ', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('auto_clicks_per_second', 'Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ', @current_sort, @current_order) %></th>
                    <th><%= sortable_link('created_at', 'ÁôªÈå≤Êó•', @current_sort, @current_order) %></th>
                    <th>Êìç‰Ωú</th>
                  </tr>
                </thead>
                <tbody>
                  <% @users.each do |user| %>
                    <tr>
                      <td><%= user.id %></td>
                      <td><%= user.name %></td>
                      <td><%= user.email %></td>
                      <td>
                        <span class="badge bg-primary"><%= user.level %></span>
                      </td>
                      <td>
                        <%= (user.total_development_time / 3600.0).round(2) %>ÊôÇÈñì
                        <br><small class="text-muted">(<%= user.total_development_time %>Áßí)</small>
                      </td>
                      <td>
                        <% if user.current_mentor_avatar %>
                          <%= user.current_mentor_avatar.name %>
                          <br><small class="text-muted">„É¨„Éô„É´<%= user.current_mentor_avatar.level %></small>
                        <% else %>
                          <span class="text-muted">Êú™Ë®≠ÂÆö</span>
                        <% end %>
                      </td>
                      <td>
                        <% requirements = user.next_level_requirements %>
                        <% if requirements[:hours_remaining] > 0 || requirements[:achievements_remaining] > 0 %>
                          <small class="text-muted">
                            <% if requirements[:hours_remaining] > 0 %>
                              ÊôÇÈñì: „ÅÇ„Å®<%= requirements[:hours_remaining].round(2) %>ÊôÇÈñì<br>
                            <% end %>
                            <% if requirements[:achievements_remaining] > 0 %>
                              ÈÅîÊàêÊï∞: „ÅÇ„Å®<%= requirements[:achievements_remaining] %>ÂÄã<br>
                            <% end %>
                          </small>
                        <% else %>
                          <span class="text-danger fw-bold">„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÂèØËÉΩÔºÅ</span>
                        <% end %>
                      </td>
                      <td>
                        <% nullpo_game = user.nullpo_game %>
                        <%= nullpo_game ? nullpo_game.formatted_nullpo_count : 0 %>
                      </td>
                      <td>
                        <%= nullpo_game ? nullpo_game.total_clicks : 0 %>
                      </td>
                      <td>
                        <%= nullpo_game ? nullpo_game.click_power : '-' %>
                      </td>
                      <td>
                        <%= nullpo_game ? nullpo_game.formatted_auto_clicks_per_second : '-' %>
                      </td>
                      <td><%= user.created_at.strftime("%Y/%m/%d %H:%M") %></td>
                      <td>
                        <div class="btn-group" role="group">
                          <%= link_to "Á∑®ÈõÜ", edit_user_path(user), class: "btn btn-outline-primary btn-sm" %>
                          <% if user.can_level_up? %>
                            <%= button_to "„É¨„Éô„É´„Ç¢„ÉÉ„Éó", level_up_user_path(user), 
                                method: :post, 
                                class: "btn btn-success btn-sm",
                                data: { confirm: "#{user.name}„Çí„É¨„Éô„É´„Ç¢„ÉÉ„Éó„Åó„Åæ„Åô„ÅãÔºüÔºà„É¨„Éô„É´#{user.level} ‚Üí #{user.level + 1}Ôºâ" } %>
                          <% else %>
                            <button class="btn btn-secondary btn-sm" disabled title="„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÊù°‰ª∂„ÇíÊ∫Ä„Åü„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì">
                              „É¨„Éô„É´„Ç¢„ÉÉ„Éó
                            </button>
                          <% end %>
                          <%= button_to "ÂâäÈô§", user_path(user), 
                              method: :delete, 
                              class: "btn btn-outline-danger btn-sm",
                              data: { confirm: "#{user.name}„Åï„Çì„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" } %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="alert alert-info">
              „É¶„Éº„Ç∂„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .sortable-link {
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .sortable-link:hover {
    background-color: rgba(0, 123, 255, 0.1);
    border-radius: 4px;
    padding: 2px 6px;
  }
  
  .sortable-link.active {
    color: #0d6efd !important;
    font-weight: bold;
  }
  
  .sortable-link.active:hover {
    background-color: rgba(0, 123, 255, 0.2);
  }
  
  th {
    position: relative;
    user-select: none;
  }
  
  th:hover {
    background-color: rgba(0, 123, 255, 0.05);
  }
</style>

<% if params[:new_mentor_id] %>
  <% new_mentor = MentorAvatar.find_by(id: params[:new_mentor_id]) %>
  <% if new_mentor %>
    <div id="mentor-get-modal" class="modal fade show" tabindex="-1" style="display: block; background: rgba(0,0,0,0.7);">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content animate__animated animate__zoomIn">
          <div class="modal-header bg-primary text-white">
            <h4 class="modal-title w-100 text-center">Êñ∞„Åó„ÅÑ„É°„É≥„Çø„Éº„Çí„Ç≤„ÉÉ„ÉàÔºÅ</h4>
          </div>
          <div class="modal-body text-center">
            <% if new_mentor.image.attached? %>
              <%= image_tag new_mentor.image, class: "img-fluid rounded shadow-lg mb-3", style: "max-height: 200px;" %>
            <% else %>
              <div class="bg-light rounded d-flex align-items-center justify-content-center mx-auto mb-3" style="height: 200px; width: 200px;">
                <span class="text-muted">No Image</span>
              </div>
            <% end %>
            <h3 class="fw-bold text-primary mb-2"><%= new_mentor.name %></h3>
            <p class="lead text-secondary mb-3"><%= new_mentor.description %></p>
            <div class="mb-3">
              <span class="badge bg-success fs-5">„É¨„Éô„É´ <%= new_mentor.level %></span>
            </div>
            <div class="mb-3 animate__animated animate__tada animate__delay-1s">
              <span style="font-size:2.5rem;">üéâ‚ú®üéä</span>
            </div>
            <p class="fw-bold text-warning">„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ</p>
          </div>
          <div class="modal-footer justify-content-center">
            <button class="btn btn-lg btn-primary" onclick="document.getElementById('mentor-get-modal').style.display='none';">Èñâ„Åò„Çã</button>
          </div>
        </div>
      </div>
    </div>
    <style>
      .modal-backdrop { display: none !important; }
      .modal.fade.show { display: block !important; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script>
      setTimeout(function(){
        document.getElementById('mentor-get-modal').style.display = 'none';
      }, 8000);
    </script>
  <% end %>
<% end %> 