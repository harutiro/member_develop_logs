<h1>Pages#home</h1>
<p>Find me in app/views/pages/home.html.erb</p>

<div class="row">
  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-body">
        <h2 class="card-title">メンターの現在の姿</h2>
        <% if @current_avatar %>
          <div class="text-center">
            <% if @current_avatar.image_url %>
              <%= image_tag @current_avatar.image_url, class: "img-fluid rounded", style: "max-height: 300px;" %>
            <% else %>
              <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 300px;">
                <p class="text-muted">画像がありません</p>
              </div>
            <% end %>
            <h3 class="mt-3"><%= @current_avatar.name %></h3>
            <p class="text-muted"><%= @current_avatar.description %></p>
          </div>
        <% else %>
          <p class="text-center">メンターがまだ現れていません...</p>
        <% end %>
      </div>
    </div>

    <!-- 開発時間記録セクション -->
    <div class="card mb-4">
      <div class="card-body">
        <h3 class="card-title">開発時間記録</h3>
        <% if @current_development_time %>
          <div class="text-center">
            <div class="alert alert-info">
              <h4>開発中です</h4>
              <p>開始時間: <%= @current_development_time.start_time.strftime("%Y/%m/%d %H:%M") %></p>
              <p>経過時間: <%= ((Time.current - @current_development_time.start_time) / 60).round %>分</p>
            </div>
            <%= form_with url: end_development_development_times_path, method: :post, local: true do |form| %>
              <%= form.submit "開発終了", class: "btn btn-danger btn-lg" %>
            <% end %>
          </div>
        <% else %>
          <div class="text-center">
            <%= form_with url: start_development_development_times_path, method: :post, local: true do |form| %>
              <div class="mb-3">
                <%= form.label :notes, "メモ（任意）", class: "form-label" %>
                <%= form.text_field :notes, class: "form-control", placeholder: "今日の目標や作業内容を記録" %>
              </div>
              <%= form.submit "開発開始", class: "btn btn-success btn-lg" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <h3 class="card-title">最近の開発時間</h3>
            <% if @recent_development_times.any? %>
              <ul class="list-group list-group-flush">
                <% @recent_development_times.each do |time| %>
                  <li class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <strong><%= time.start_time.strftime("%Y/%m/%d %H:%M") %></strong>
                        <br>
                        <small class="text-muted"><%= time.duration.present? ? (time.duration / 60) : "-" %>分</small>
                      </div>
                      <% if time.notes.present? %>
                        <span class="badge bg-primary"><%= time.notes %></span>
                      <% end %>
                    </div>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="text-center">まだ開発時間が記録されていません</p>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <h3 class="card-title">最近のできたこと</h3>
            <% if @recent_achievements.any? %>
              <ul class="list-group list-group-flush">
                <% @recent_achievements.each do |achievement| %>
                  <li class="list-group-item">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <strong><%= achievement.content %></strong>
                        <br>
                        <small class="text-muted"><%= achievement.category %></small>
                      </div>
                      <span class="badge bg-success">+<%= achievement.points %>pt</span>
                    </div>
                  </li>
                <% end %>
              </ul>
            <% else %>
              <p class="text-center">まだできたことが記録されていません</p>
            <% end %>
            <%= link_to "できたことを記録", new_achievement_path, class: "btn btn-success mt-3" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card mb-4">
      <div class="card-body">
        <h3 class="card-title">あなたの成長</h3>
        <div class="text-center mb-4">
          <h4>総開発時間</h4>
          <h2 class="text-primary"><%= @total_development_time / 3600 %>時間</h2>
        </div>
        <div class="text-center">
          <h4>達成したこと</h4>
          <h2 class="text-success"><%= @achievement_count %>個</h2>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h3 class="card-title">次の目標</h3>
        <div class="progress mb-3">
          <div class="progress-bar" role="progressbar" style="width: <%= (@total_development_time / 3600.0 / 100 * 100).clamp(0, 100) %>%">
            <%= (@total_development_time / 3600.0 / 100 * 100).clamp(0, 100).round %>% 
          </div>
        </div>
        <p class="text-center">次のレベルまであと<%= 100 - (@total_development_time / 3600) %>時間</p>
      </div>
    </div>
  </div>
</div>
